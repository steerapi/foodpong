// Generated by CoffeeScript 1.3.3
var ConfirmCtrl, FirstCtrl, GraphsCtrl, IndexCtrl, LoginCtrl, ManageOrdersCtrl, ManageSubscriptionsCtrl, OrdersCtrl, RestaurantsCtrl, SettingsCtrl, SignupCtrl, createNewUser, login, logout;

Usergrid.ApiClient.init('steerapi', 'sandbox');

/*
Function to handle the create new user form submission.

First we make sure there are no errors on the form (in case they
submitted prior and have corrected some data).
Next, we get all the new data out of the form, validate it, then
call the create app user function to send it to the API

@method createNewUser
@return none
*/


login = function(username, password, cb) {
  return Usergrid.ApiClient.logInAppUser(username, password, (function(response, user) {
    var appUser;
    appUser = Usergrid.ApiClient.getLoggedInUser();
    return typeof cb === "function" ? cb(false, appUser) : void 0;
  }), function() {
    return typeof cb === "function" ? cb(true) : void 0;
  });
};

logout = function() {
  return Usergrid.ApiClient.logoutAppUser();
};

createNewUser = function(username, email, password, cb) {
  var appUser;
  if (Usergrid.validation.validateUsername(username, function() {}) && Usergrid.validation.validateEmail(email, function() {}) && Usergrid.validation.validatePassword(password, function() {})) {
    appUser = new Usergrid.Entity("users");
    appUser.set({
      username: username,
      email: email,
      password: password
    });
    return appUser.save((function() {
      return login(username, password, cb);
    }), function() {});
  } else {
    include(first);
    include(confirm);
    include(graphs);
    include(manageorders);
    include(managesubscriptions);
    include(settings);
    include(orders);
    return include(restaurants);
  }
};

IndexCtrl = function($scope) {};

FirstCtrl = function($scope) {
  $scope.username = "";
  $scope.isLoggedIn = function() {
    var username;
    username = Usergrid.ApiClient.getLoggedInUser();
    if (username) {
      $scope.username = username._data.username;
      return true;
    } else {
      return false;
    }
  };
  return $scope.logout = function() {
    return logout();
  };
};

ConfirmCtrl = function($scope) {};

GraphsCtrl = function($scope) {};

ManageOrdersCtrl = function($scope) {};

ManageSubscriptionsCtrl = function($scope) {};

SettingsCtrl = function($scope) {};

OrdersCtrl = function($scope) {};

RestaurantsCtrl = function($scope) {};

LoginCtrl = function($scope) {
  $scope.username = "";
  $scope.password = "";
  return $scope.login = function() {
    return login($scope.username, $scope.password, function(err, user) {
      if (!err) {
        history.back();
        return localStorage.setItem("username", user._data.username);
      }
    });
  };
};

SignupCtrl = function($scope) {
  $scope.username = "";
  $scope.email = "";
  $scope.password = "";
  return $scope.signup = function() {
    return createNewUser($scope.username, $scope.email, $scope.password, function(err, user) {
      if (!err) {
        history.back();
        return localStorage.setItem("username", user._data.username);
      }
    });
  };
};
